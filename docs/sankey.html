<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sankey Diagram | CellChat Analysis</title>
    <!-- Load D3.js and d3-sankey -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/d3-sankey@0.12.3/dist/d3-sankey.min.js"></script>
    <style>
        :root {
            --bg-color: #ffffff;
            --panel-bg: #f8fafc;
            --text-primary: #1e293b;
            --text-secondary: #475569;
            --border-color: #cbd5e1;
            --accent-color: #2563eb;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-primary);
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            background: #ffffff;
            padding: 20px 40px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            margin: 0;
            font-size: 1.8rem;
            font-weight: 700;
            font-size: 1.8rem;
            font-weight: 700;
            color: #1e293b;
        }

        .subtitle {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .back-link {
            text-decoration: none;
            color: var(--text-secondary);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 6px;
            background: rgba(0, 0, 0, 0.05);
            transition: all 0.2s;
        }

        .back-link:hover {
            background: rgba(0, 0, 0, 0.1);
            color: var(--text-primary);
        }

        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Sidebar Controls */
        .sidebar {
            width: 350px;
            background-color: var(--panel-bg);
            border-right: 1px solid var(--border-color);
            padding: 1.5rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .control-group label {
            font-weight: 600;
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        input[type="range"] {
            width: 100%;
            accent-color: var(--accent-color);
        }

        /* Checkbox Style */
        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 10px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 6px;
            transition: background 0.2s;
        }

        .checkbox-wrapper:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--accent-color);
            cursor: pointer;
        }

        .chart-area {
            flex: 1;
            padding: 20px;
            overflow: auto;
            position: relative;
        }

        #sankeySvg {
            width: 100%;
            height: 100%;
            min-height: 600px;
        }

        .node rect {
            cursor: pointer;
            fill-opacity: 0.9;
        }

        .node rect:hover {
            fill-opacity: 1;
            stroke: #334155;
            stroke-width: 1px;
        }

        .node circle {
            cursor: pointer;
            stroke: #334155;
            stroke-width: 1px;
        }

        .node circle:hover {
            stroke-width: 2px;
        }

        .link {
            fill: none;
            stroke-opacity: 0.3;
            transition: stroke-opacity 0.2s;
        }

        .link:hover {
            stroke-opacity: 0.6;
        }

        .node text {
            font-size: 12px;
            fill: var(--text-primary);
            pointer-events: none;
        }

        .legend {
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .color-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        /* Column Headers */
        .column-header {
            font-size: 14px;
            font-weight: bold;
            fill: #475569;
            text-anchor: middle;
        }

        .column-sub {
            font-size: 11px;
            fill: #64748b;
            font-weight: normal;
        }

        /* Mapping Table Overlay */
        .overlay-container {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            bottom: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            display: none;
            flex-direction: column;
            z-index: 100;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
        }

        .overlay-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .overlay-header h2 {
            margin: 0;
            font-size: 1.2rem;
            color: var(--text-primary);
        }

        /* Expandable Cell Styles */
        .expandable-cell {
            cursor: pointer;
            position: relative;
            padding-right: 25px !important;
            transition: background 0.2s;
        }

        .expandable-cell:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .expand-toggle {
            position: absolute;
            right: 8px;
            top: 12px;
            font-size: 0.8rem;
            transition: transform 0.3s;
            color: var(--accent-color);
            opacity: 0.7;
        }

        .expandable-cell.expanded .expand-toggle {
            transform: rotate(180deg);
        }

        .summary-text {
            display: block;
        }

        .expandable-cell.expanded .summary-text {
            display: none;
        }

        .full-content {
            display: none;
            padding-top: 5px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            line-height: 1.4;
        }

        .expandable-cell.expanded .full-content {
            display: block;
        }

        .close-btn {
            background: rgba(0, 0, 0, 0.1);
            border: none;
            color: var(--text-primary);
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .close-btn:hover {
            background: rgba(0, 0, 0, 0.2);
        }

        .table-wrapper {
            flex: 1;
            overflow: auto;
            padding: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        th {
            text-align: left;
            padding: 12px;
            border-bottom: 2px solid var(--border-color);
            color: var(--text-primary);
            position: sticky;
            top: 0;
            background: #f8fafc;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        tr:hover td {
            background: rgba(0, 0, 0, 0.02);
            color: var(--text-primary);
        }

        .btn-primary {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 10px;
        }

        .btn-primary:hover {
            filter: brightness(1.2);
            transform: translateY(-1px);
        }
    </style>
</head>

<body>

    <header>
        <div>
            <h1>Biological Process → CellChat Pathway (with Genes)</h1>
            <div class="subtitle">Mapping Gene Signatures to Functional Hubs</div>
        </div>
        <a href="index.html" class="back-link">← Back to Dashboard</a>
    </header>

    <div class="main-container">
        <div class="sidebar">

            <div class="control-group">
                <label>Visualization Controls</label>
                <div>
                    <span style="font-size:0.8rem; color:var(--text-secondary)">Node Padding</span>
                    <input type="range" id="nodePad" min="5" max="50" value="15" oninput="updateChart()">
                </div>
                <div>
                    <span style="font-size:0.8rem; color:var(--text-secondary)">Link Opacity</span>
                    <input type="range" id="linkOpacity" min="0.1" max="0.8" step="0.1" value="0.3"
                        oninput="updateChart()">
                </div>
                <div>
                    <span style="font-size:0.8rem; color:var(--text-secondary)">Chart Height</span>
                    <input type="range" id="chartHeight" min="600" max="2500" step="50" value="800"
                        oninput="resizeChart()">
                </div>
            </div>

            <div class="control-group">
                <label>Data Verification</label>
                <button class="btn-primary" onclick="toggleTable()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 3h18v18H3zM3 9h18M3 15h18M9 3v18" />
                    </svg>
                    View Mapping Table
                </button>
                <div style="font-size: 0.75rem; color: var(--text-secondary); font-style: italic;">
                    Cross-referencing genes with Reactome Primary Processes for manuscript validation.
                </div>
            </div>

            <!-- Fold Change Mode Removed for 2-Column Layout -->

            <div class="legend" id="legendContainer">
                <label style="margin-bottom:10px; display:block">Signature Categories</label>
                <div class="legend-item">
                    <div class="color-dot" style="background: #e74c3c"></div>
                    (Pro-Tumour)
                </div>
                <div class="legend-item">
                    <div class="color-dot" style="background: #27ae60"></div>
                    (Anti-Tumour)
                </div>
                <div class="legend-item">
                    <div class="color-dot" style="background: #00897b"></div>
                    (Hypoxia & Metabolism)
                </div>
            </div>

            <!-- Circle Size Legend (Dynamic) -->
            <div id="fcLegend"
                style="display:none; margin-top:20px; padding-top:20px; border-top:1px solid var(--border-color)">
                <label style="margin-bottom:10px; display:block">Log2 Fold Change</label>
                <div style="display:flex; align-items:center; gap:15px; color:var(--text-secondary); font-size:0.8rem;">
                    <div style="text-align:center">
                        <div style="width:6px; height:6px; background:#64748b; border-radius:50%; margin:0 auto 4px;">
                        </div>Low
                    </div>
                    <div style="text-align:center">
                        <div style="width:12px; height:12px; background:#64748b; border-radius:50%; margin:0 auto 4px;">
                        </div>Med
                    </div>
                    <div style="text-align:center">
                        <div style="width:20px; height:20px; background:#64748b; border-radius:50%; margin:0 auto 4px;">
                        </div>High
                    </div>
                </div>
            </div>

        </div>

        <div class="chart-area" id="chartContainer">
            <svg id="sankeySvg"></svg>

            <!-- Table Overlay -->
            <div id="tableOverlay" class="overlay-container">
                <div class="overlay-header">
                    <h2>Gene-to-Process Mapping Validation</h2>
                    <button class="close-btn" onclick="toggleTable()">Close Table</button>
                </div>
                <div class="table-wrapper">
                    <table id="mappingTable">
                        <thead>
                            <tr>
                                <th>Gene</th>
                                <th>Manuscript Classification</th>
                                <th>Reactome IDs</th>
                                <th>Reactome Primary Process</th>
                                <th>Top Reactome Pathways</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <!-- Injected by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="tooltip"
        style="position: absolute; display: none; background: rgba(255, 255, 255, 0.95); color: #1e293b; padding: 8px; border-radius: 4px; pointer-events: none; font-size: 12px; z-index: 1000; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: 1px solid #cbd5e1;">
    </div>

    <script>
        // --- Configuration ---
        const COLORS = {
            "Pro-Tumour": "#e74c3c", // Red
            "Anti-Tumour": "#27ae60", // Green
            "Metabolic": "#00897b",   // Teal (Replaces Purple)
            "Default": "#94a3b8"      // Slate 400
        };

        let sankeyData = { nodes: [], links: [] };

        const svg = d3.select("#sankeySvg");
        const container = document.getElementById("chartContainer");
        const tooltip = d3.select("#tooltip");

        // --- Data Loading ---
        async function loadData() {
            try {
                // Load Sankey Structure with cache busting
                const csvData = await d3.csv(`data/sankey_data.csv?v=${Date.now()}`);

                processData(csvData);
                updateChart();

            } catch (error) {
                console.error("Error:", error);
                container.innerHTML = `<div style="color:red; padding:20px">Error: ${error.message}</div>`;
            }
        }

        // --- Process Data into Nodes/Links ---
        function processData(rawData) {
            let nodes = [];
            let nodeMap = new Map();
            let links = [];

            // Helper to get/create node
            function addNode(name, category, type) {
                const id = `${name}__${type}`;
                if (!nodeMap.has(id)) {
                    let color = COLORS.Default;
                    // Process nodes get colored by their Source category
                    if (type === "process" && category) {
                        if (category.includes("Pro-Tumour")) color = COLORS["Pro-Tumour"];
                        else if (category.includes("Anti-Tumour")) color = COLORS["Anti-Tumour"];
                        else if (category.includes("Metabolism")) color = COLORS["Metabolic"];
                    }

                    // Pathway nodes can inherit color or stay neutral. 
                    // Let's keep them neutral (Default) so the links (colored by source) pop out, 
                    // OR color them if they are strictly associated with one category.
                    // For now, default.

                    nodes.push({
                        name: name,
                        type: type,
                        category: category,
                        color: color,
                        id: id,
                        genes: new Set() // Store unique genes associated with this node (for Pathways)
                    });
                    nodeMap.set(id, nodes.length - 1);
                }
                return nodeMap.get(id);
            }

            rawData.forEach(row => {
                // Function to clean names
                const clean = (s) => {
                    const match = s.match(/^\((.*?)\)$/);
                    if (match) return match[1].trim();
                    if (s.includes("ANGPT")) return s.trim();
                    return s.replace(/\s*\(.*?\)\s*/g, '').trim();
                };

                const sourceNameRaw = row.Source; // Used for coloring
                const processName = clean(row.Process);
                const genes = row.Genes ? row.Genes.split(',').map(s => clean(s.trim())).filter(s => s) : [];
                const hubs = row.Hubs ? row.Hubs.split(',').map(s => clean(s.trim())).filter(s => s) : [];

                // 1. Process Node (Level 0)
                // We do NOT create a Source node. We just use sourceNameRaw to color the Process node.
                const procIdx = addNode(processName, sourceNameRaw, "process");

                // 2. Pathway Node (Level 1)
                hubs.forEach(hub => {
                    const hubIdx = addNode(hub, sourceNameRaw, "pathway");

                    // Add genes to the Pathway node's set
                    const hubNode = nodes[hubIdx];
                    genes.forEach(g => hubNode.genes.add(g));

                    // Link: Process -> Pathway
                    // Value = number of genes in this interaction
                    links.push({ source: procIdx, target: hubIdx, value: genes.length || 1 });
                });
            });

            // Post-process: Update Pathway names labels
            nodes.forEach(n => {
                n.displayName = n.name; // Keep name clean, genes handled in renderer
            });

            sankeyData = { nodes, links };
        }

        // --- Rendering ---
        function updateChart() {
            const width = container.clientWidth - 40;
            const height = parseInt(document.getElementById("chartHeight").value);
            const nodePad = parseInt(document.getElementById("nodePad").value);
            const linkOpacity = document.getElementById("linkOpacity").value;

            // Hide FC Controls/Legend as they are no longer relevant in 2-column mode
            // document.getElementById("fcMode").disabled = true; 
            document.getElementById("fcLegend").style.display = "none";

            svg.attr("width", width).attr("height", height);
            svg.selectAll("*").remove();

            // Sankey Layout
            const sankey = d3.sankey()
                .nodeWidth(15)
                .nodePadding(nodePad)
                .extent([[50, 60], [width - 350, height - 20]]) // Increased right margin for long gene labels
                .nodeId(d => d.index);

            // Deep copy data 
            const graph = {
                nodes: sankeyData.nodes.map(d => ({ ...d })),
                links: sankeyData.links.map(d => ({ ...d }))
            };

            sankey(graph);

            // --- Drawing ---

            // 1. Links
            const link = svg.append("g")
                .attr("fill", "none")
                .attr("stroke-opacity", linkOpacity)
                .selectAll("path")
                .data(graph.links)
                .join("path")
                .attr("class", "link")
                .attr("d", d3.sankeyLinkHorizontal())
                .attr("stroke", d => d.source.color) // Link color = Process color
                .attr("stroke-width", d => Math.max(1, d.width));

            link.append("title").text(d => `${d.source.name} → ${d.target.name}\nValue: ${d.value}`);

            // 2. Nodes
            const node = svg.append("g")
                .selectAll("g")
                .data(graph.nodes)
                .join("g")
                .attr("class", "node")
                .attr("transform", d => `translate(${d.x0},${d.y0})`)
                .call(d3.drag()
                    .subject(d => d)
                    .on("start", function () { this.parentNode.appendChild(this); })
                    .on("drag", dragmod));

            function dragmod(event, d) {
                const rectY = (d.y1 - d.y0);
                const rectX = (d.x1 - d.x0);

                const oldY = d.y0;

                // Constrain traversal to height
                d.y0 = Math.max(0, Math.min(height - rectY, event.y));
                d.y1 = d.y0 + rectY;

                const dy = d.y0 - oldY;

                // Allow Horizontal Dragging (constrained to width)
                d.x0 = Math.max(0, Math.min(width - rectX, event.x));
                d.x1 = d.x0 + rectX;

                d3.select(this).attr("transform", `translate(${d.x0},${d.y0})`);

                // Update connected links (vertical position)
                // Source links (originating from this node) -> Update y0
                const sourceLinks = graph.links.filter(l => l.source.index === d.index);
                sourceLinks.forEach(l => {
                    l.y0 += dy;
                });

                // Target links (ending at this node) -> Update y1
                const targetLinks = graph.links.filter(l => l.target.index === d.index);
                targetLinks.forEach(l => {
                    l.y1 += dy;
                });

                // Redraw links
                // Note: d3.sankeyLinkHorizontal uses d.source.x1, d.target.x0, d.y0, d.y1. 
                // We updated d.source/d.target x-values (via d.x0/x1 references) and manually updated l.y0/l.y1.
                svg.selectAll(".link").attr("d", d3.sankeyLinkHorizontal());
            }

            // Rects
            node.append("rect")
                .attr("height", d => d.y1 - d.y0)
                .attr("width", d => d.x1 - d.x0)
                .attr("fill", d => d.color);

            // Node Labels
            const labels = node.append("text")
                .style("font-size", "12px")
                .style("fill", "#1e293b")
                .style("pointer-events", "none");

            labels.each(function (d) {
                const el = d3.select(this);
                const nodeWidth = d.x1 - d.x0;
                const nodeHeight = d.y1 - d.y0;
                const centerY = nodeHeight / 2;

                if (d.type === "process") {
                    // Source Nodes: Label on Right
                    el.append("tspan")
                        .attr("x", nodeWidth + 6)
                        .attr("y", centerY)
                        .attr("dy", "0.35em")
                        .attr("text-anchor", "start")
                        .text(d.name);
                } else {
                    // Pathway Nodes (Targets)

                    // 1. Pathway Name on RIGHT
                    el.append("tspan")
                        .attr("x", nodeWidth + 6)
                        .attr("y", centerY)
                        .attr("dy", "0.35em")
                        .attr("text-anchor", "start")
                        .style("font-weight", "bold")
                        .text(d.name);

                    // 2. Genes on LEFT
                    const geneList = Array.from(d.genes);
                    if (geneList.length > 0) {
                        // Chunk genes into groups of max 3
                        const chunks = [];
                        for (let i = 0; i < geneList.length; i += 3) {
                            chunks.push(geneList.slice(i, i + 3).join(", "));
                        }

                        const lineHeight = 1.1; // em (approx 13px)
                        // Vertical start calculation to center the block
                        // Block height = chunks.length * lineHeight
                        // Top of block relative to center = - (Block height / 2)
                        // Add 0.35em for baseline correction

                        chunks.forEach((chunk, i) => {
                            // Calculate explicit Y offset for each line to avoid overlap
                            // Offset from center: (i - (total-1)/2) * lh
                            // Convert to ems relative to centerY

                            el.append("tspan")
                                .attr("x", -6)
                                // Do NOT set 'y' here if using relative dy from previous, 
                                // BUT mixing explicit y (for first line) and relative dy (for others) is safer 
                                // if we handle it carefully.
                                // SAFEST: Set explicit y for EVERY line.
                                .attr("y", centerY)
                                .attr("dy", `${(i - (chunks.length - 1) / 2) * lineHeight + 0.35}em`)
                                .attr("text-anchor", "end")
                                .style("font-weight", "bold")
                                .style("fill", "#475569")
                                .text(chunk);
                        });
                    }
                }
            });

            // 3. Headers
            const headerG = svg.append("g");
            // Simple 2-column headers
            drawHeader(headerG, 50, "Biological Process", "Colored by Tumour Effect");
            drawHeader(headerG, width - 350, "CellChat Pathway", "Genes Associated");
        }

        function drawHeader(g, x, title, sub) {
            g.append("text")
                .attr("class", "column-header")
                .attr("x", x)
                .attr("y", 30)
                .attr("text-anchor", "start") // Align left for predictability
                .text(title);

            if (sub) {
                g.append("text")
                    .attr("class", "column-sub")
                    .attr("x", x)
                    .attr("y", 45)
                    .attr("text-anchor", "start")
                    .text(sub);
            }
        }

        function resizeChart() {
            const height = document.getElementById('chartHeight').value;
            document.getElementById('sankeySvg').style.height = height + 'px';
            updateChart();
        }

        window.addEventListener("resize", updateChart);

        // --- Table Logic ---
        const MAPPING_DATA = [{ "Gene": "FN1", "Manual": "ECM Remodeling & Invasion", "IDs": "REACTOME:R-HSA-109582, REACTOME:R-HSA-114608, REACTOME:R-HSA-1266738, REACTOME:R-HSA-1280215, REACTOME:R-HSA-1474228, REACTOME:R-HSA-1474244, REACTOME:R-HSA-1566948, REACTOME:R-HSA-1566977, REACTOME:R-HSA-162582, REACTOME:R-HSA-1643685, REACTOME:R-HSA-168256, REACTOME:R-HSA-202733, REACTOME:R-HSA-2129379, REACTOME:R-HSA-216083, REACTOME:R-HSA-3000170, REACTOME:R-HSA-3000171, REACTOME:R-HSA-3000178, REACTOME:R-HSA-354192, REACTOME:R-HSA-354194, REACTOME:R-HSA-372708, REACTOME:R-HSA-372790, REACTOME:R-HSA-381426, REACTOME:R-HSA-388396, REACTOME:R-HSA-392499, REACTOME:R-HSA-418555, REACTOME:R-HSA-449147, REACTOME:R-HSA-5663202, REACTOME:R-HSA-5663205, REACTOME:R-HSA-5673001, REACTOME:R-HSA-5674135, REACTOME:R-HSA-5683057, REACTOME:R-HSA-5684996, REACTOME:R-HSA-597592, REACTOME:R-HSA-6785807, REACTOME:R-HSA-6802946, REACTOME:R-HSA-6802948, REACTOME:R-HSA-6802949, REACTOME:R-HSA-6802952, REACTOME:R-HSA-6802955, REACTOME:R-HSA-6802957, REACTOME:R-HSA-6806834, REACTOME:R-HSA-76002, REACTOME:R-HSA-76005, REACTOME:R-HSA-76009, REACTOME:R-HSA-8874081, REACTOME:R-HSA-8875878, REACTOME:R-HSA-8953897, REACTOME:R-HSA-8957275, REACTOME:R-HSA-9006934, REACTOME:R-HSA-9634597, REACTOME:R-HSA-9638630, REACTOME:R-HSA-9640148, REACTOME:R-HSA-9649948, REACTOME:R-HSA-9656223, REACTOME:R-HSA-9700206, REACTOME:R-HSA-9700645, REACTOME:R-HSA-9725370, REACTOME:R-HSA-9734767, REACTOME:R-HSA-9820448, REACTOME:R-HSA-9824439, REACTOME:R-HSA-9855142, REACTOME:R-HSA-9860927, REACTOME:R-HSA-9860931, REACTOME:R-HSA-9925563, REACTOME:R-HSA-9931953", "Reactome": "Angiogenesis_Vascular_Hemostasis, Other_Mixed_or_Generic, Cytokine_JAK_STAT_Signaling, ECM_Remodeling_Adhesion, Metabolism, Oncogenic_GrowthFactor_Signaling", "Pathways": "Hemostasis, Platelet degranulation, Developmental Biology" }, { "Gene": "SPP1", "Manual": "ECM Remodeling & Invasion", "IDs": "REACTOME:R-HSA-1474228, REACTOME:R-HSA-1474244, REACTOME:R-HSA-162582, REACTOME:R-HSA-186797, REACTOME:R-HSA-212436, REACTOME:R-HSA-216083, REACTOME:R-HSA-381426, REACTOME:R-HSA-392499, REACTOME:R-HSA-597592, REACTOME:R-HSA-73857, REACTOME:R-HSA-74160, REACTOME:R-HSA-8878159, REACTOME:R-HSA-8949275, REACTOME:R-HSA-8953897, REACTOME:R-HSA-8957275, REACTOME:R-HSA-9006934, REACTOME:R-HSA-9855142, REACTOME:R-HSA-9856532", "Reactome": "ECM_Remodeling_Adhesion, Other_Mixed_or_Generic, Oncogenic_GrowthFactor_Signaling, Metabolism", "Pathways": "Degradation of the extracellular matrix, Extracellular matrix organization, Signal Transduction" }, { "Gene": "GPNMB", "Manual": "ECM Remodeling & Invasion", "IDs": "REACTOME:R-HSA-162582, REACTOME:R-HSA-8848021, REACTOME:R-HSA-8857538, REACTOME:R-HSA-9006927", "Reactome": "Other_Mixed_or_Generic", "Pathways": "Signal Transduction, Signaling by PTK6, PTK6 promotes HIF1A stabilization" }, { "Gene": "FLOT1", "Manual": "ECM Remodeling & Invasion", "IDs": "REACTOME:R-HSA-112316, REACTOME:R-HSA-162582, REACTOME:R-HSA-194315, REACTOME:R-HSA-5213460, REACTOME:R-HSA-5218859, REACTOME:R-HSA-5357801, REACTOME:R-HSA-5675482, REACTOME:R-HSA-6794362, REACTOME:R-HSA-8849932, REACTOME:R-HSA-8980692, REACTOME:R-HSA-9012999, REACTOME:R-HSA-9013026, REACTOME:R-HSA-9013106, REACTOME:R-HSA-9716542", "Reactome": "Other_Mixed_or_Generic, Apoptosis_Survival, ECM_Remodeling_Adhesion", "Pathways": "Neuronal System, Signal Transduction, Signaling by Rho GTPases" }, { "Gene": "CD44", "Manual": "Tumour Adhesion & Migration", "IDs": "REACTOME:R-HSA-109582, REACTOME:R-HSA-1280215, REACTOME:R-HSA-1430728, REACTOME:R-HSA-1474228, REACTOME:R-HSA-1474244, REACTOME:R-HSA-1630316, REACTOME:R-HSA-168249, REACTOME:R-HSA-168256, REACTOME:R-HSA-202733, REACTOME:R-HSA-2142845, REACTOME:R-HSA-216083, REACTOME:R-HSA-2160916, REACTOME:R-HSA-428359, REACTOME:R-HSA-6798695, REACTOME:R-HSA-71387, REACTOME:R-HSA-877300, REACTOME:R-HSA-8953854, REACTOME:R-HSA-913531", "Reactome": "Angiogenesis_Vascular_Hemostasis, Cytokine_JAK_STAT_Signaling, Metabolism, ECM_Remodeling_Adhesion, Innate_Immunity_Myeloid_Phagocyte, Other_Mixed_or_Generic", "Pathways": "Hemostasis, Cytokine Signaling in Immune system, Metabolism" }, { "Gene": "ITGAM", "Manual": "Tumour Adhesion & Migration", "IDs": "REACTOME:R-HSA-109582, REACTOME:R-HSA-1280215, REACTOME:R-HSA-1474244, REACTOME:R-HSA-166016, REACTOME:R-HSA-168249, REACTOME:R-HSA-168256, REACTOME:R-HSA-168898, REACTOME:R-HSA-202733, REACTOME:R-HSA-216083, REACTOME:R-HSA-449147, REACTOME:R-HSA-6785807, REACTOME:R-HSA-6798695", "Reactome": "Angiogenesis_Vascular_Hemostasis, Cytokine_JAK_STAT_Signaling, ECM_Remodeling_Adhesion, Innate_Immunity_Myeloid_Phagocyte, Other_Mixed_or_Generic", "Pathways": "Hemostasis, Cytokine Signaling in Immune system, Extracellular matrix organization" }, { "Gene": "ALCAM", "Manual": "Tumour Adhesion & Migration", "IDs": "REACTOME:R-HSA-1266738, REACTOME:R-HSA-373760, REACTOME:R-HSA-422475, REACTOME:R-HSA-9675108", "Reactome": "Other_Mixed_or_Generic", "Pathways": "Developmental Biology, L1CAM interactions, Axon guidance" }, { "Gene": "LGALS3", "Manual": "Tumour Adhesion & Migration", "IDs": "REACTOME:R-HSA-168249, REACTOME:R-HSA-168256, REACTOME:R-HSA-212436, REACTOME:R-HSA-6798695, REACTOME:R-HSA-73857, REACTOME:R-HSA-74160, REACTOME:R-HSA-879415, REACTOME:R-HSA-8878166, REACTOME:R-HSA-8878171, REACTOME:R-HSA-8939246, REACTOME:R-HSA-8941333", "Reactome": "Innate_Immunity_Myeloid_Phagocyte, Other_Mixed_or_Generic", "Pathways": "Innate Immune System, Immune System, Generic Transcription Pathway" }, { "Gene": "ACTB", "Manual": "Cytoskeletal Dynamics", "IDs": "REACTOME:R-HSA-109582, REACTOME:R-HSA-1169410, REACTOME:R-HSA-1266738, REACTOME:R-HSA-1280215, REACTOME:R-HSA-1445148, REACTOME:R-HSA-1474244, REACTOME:R-HSA-1500931, REACTOME:R-HSA-157858, REACTOME:R-HSA-162582, REACTOME:R-HSA-1643685, REACTOME:R-HSA-168249, REACTOME:R-HSA-168256, REACTOME:R-HSA-190828, REACTOME:R-HSA-190873, REACTOME:R-HSA-194138, REACTOME:R-HSA-194315, REACTOME:R-HSA-195258, REACTOME:R-HSA-196025, REACTOME:R-HSA-199991, REACTOME:R-HSA-2029480, REACTOME:R-HSA-2029482, REACTOME:R-HSA-212165, REACTOME:R-HSA-2682334, REACTOME:R-HSA-3000171, REACTOME:R-HSA-3214847, REACTOME:R-HSA-3247509, REACTOME:R-HSA-373760, REACTOME:R-HSA-389957, REACTOME:R-HSA-389958, REACTOME:R-HSA-390450, REACTOME:R-HSA-390466, REACTOME:R-HSA-391251, REACTOME:R-HSA-392499, REACTOME:R-HSA-3928662, REACTOME:R-HSA-3928665, REACTOME:R-HSA-418990, REACTOME:R-HSA-421270, REACTOME:R-HSA-422475, REACTOME:R-HSA-428359, REACTOME:R-HSA-437239, REACTOME:R-HSA-4420097, REACTOME:R-HSA-445095, REACTOME:R-HSA-446353, REACTOME:R-HSA-446728, REACTOME:R-HSA-4839726, REACTOME:R-HSA-5250913, REACTOME:R-HSA-5250924, REACTOME:R-HSA-5626467, REACTOME:R-HSA-5653656, REACTOME:R-HSA-5663202, REACTOME:R-HSA-5663205, REACTOME:R-HSA-5663213, REACTOME:R-HSA-5663220, REACTOME:R-HSA-5673001, REACTOME:R-HSA-5674135, REACTOME:R-HSA-5683057, REACTOME:R-HSA-5684996, REACTOME:R-HSA-5688426, REACTOME:R-HSA-5689603, REACTOME:R-HSA-5696394, REACTOME:R-HSA-5696398, REACTOME:R-HSA-5696399, REACTOME:R-HSA-597592, REACTOME:R-HSA-6802946, REACTOME:R-HSA-6802948, REACTOME:R-HSA-6802949, REACTOME:R-HSA-6802952, REACTOME:R-HSA-6802955, REACTOME:R-HSA-6802957, REACTOME:R-HSA-73894, REACTOME:R-HSA-74160, REACTOME:R-HSA-8856828, REACTOME:R-HSA-8953854, REACTOME:R-HSA-9006934, REACTOME:R-HSA-9012999, REACTOME:R-HSA-9035034, REACTOME:R-HSA-913531, REACTOME:R-HSA-9649948, REACTOME:R-HSA-9656223, REACTOME:R-HSA-9658195, REACTOME:R-HSA-9659379, REACTOME:R-HSA-9662360, REACTOME:R-HSA-9662361, REACTOME:R-HSA-9664407, REACTOME:R-HSA-9664417, REACTOME:R-HSA-9664422, REACTOME:R-HSA-9675108, REACTOME:R-HSA-9709957, REACTOME:R-HSA-9716542, REACTOME:R-HSA-9730414, REACTOME:R-HSA-9759476, REACTOME:R-HSA-9764265, REACTOME:R-HSA-9764274, REACTOME:R-HSA-9764561, REACTOME:R-HSA-9824443, REACTOME:R-HSA-9824585, REACTOME:R-HSA-983231, REACTOME:R-HSA-9842860, REACTOME:R-HSA-9845323, REACTOME:R-HSA-9856651, REACTOME:R-HSA-9913351, REACTOME:R-HSA-9932444, REACTOME:R-HSA-9932451, REACTOME:R-HSA-9933937, REACTOME:R-HSA-9933939, REACTOME:R-HSA-9933946, REACTOME:R-HSA-9933947, REACTOME:R-HSA-9934037, REACTOME:R-HSA-9953170", "Reactome": "Angiogenesis_Vascular_Hemostasis, Cytokine_JAK_STAT_Signaling, Other_Mixed_or_Generic, ECM_Remodeling_Adhesion, Innate_Immunity_Myeloid_Phagocyte, Metabolism, Cell_Cycle_DNA_Replication, Oncogenic_GrowthFactor_Signaling", "Pathways": "Hemostasis, Antimicrobial mechanism of IFN-stimulated genes, Developmental Biology" }, { "Gene": "RHOQ", "Manual": "Cytoskeletal Dynamics", "IDs": "REACTOME:R-HSA-1445148, REACTOME:R-HSA-162582, REACTOME:R-HSA-194315, REACTOME:R-HSA-195258, REACTOME:R-HSA-199991, REACTOME:R-HSA-5627083, REACTOME:R-HSA-5653656, REACTOME:R-HSA-9012999, REACTOME:R-HSA-9013406, REACTOME:R-HSA-9716542", "Reactome": "Other_Mixed_or_Generic", "Pathways": "Translocation of SLC2A4 (GLUT4) to the plasma membrane, Signal Transduction, Signaling by Rho GTPases" }, { "Gene": "FMNL2", "Manual": "Cytoskeletal Dynamics", "IDs": "REACTOME:R-HSA-162582, REACTOME:R-HSA-194315, REACTOME:R-HSA-195258, REACTOME:R-HSA-5663220, REACTOME:R-HSA-9012999, REACTOME:R-HSA-9013106, REACTOME:R-HSA-9013148, REACTOME:R-HSA-9716542", "Reactome": "Other_Mixed_or_Generic", "Pathways": "Signal Transduction, Signaling by Rho GTPases, RHO GTPase Effectors" }, { "Gene": "PLEC", "Manual": "Cytoskeletal Dynamics", "IDs": "REACTOME:R-HSA-109581, REACTOME:R-HSA-111465, REACTOME:R-HSA-1474244, REACTOME:R-HSA-1474290, REACTOME:R-HSA-1500931, REACTOME:R-HSA-2022090, REACTOME:R-HSA-264870, REACTOME:R-HSA-446107, REACTOME:R-HSA-446728, REACTOME:R-HSA-5357801, REACTOME:R-HSA-75153", "Reactome": "Apoptosis_Survival, Other_Mixed_or_Generic, ECM_Remodeling_Adhesion", "Pathways": "Apoptosis, Apoptotic cleavage of cellular proteins, Extracellular matrix organization" }, { "Gene": "PTPN12", "Manual": "Immune Evasion Checkpoints", "IDs": "REACTOME:R-HSA-1227986, REACTOME:R-HSA-1227990, REACTOME:R-HSA-1250196, REACTOME:R-HSA-1280215, REACTOME:R-HSA-162582, REACTOME:R-HSA-1643685, REACTOME:R-HSA-168256, REACTOME:R-HSA-177929, REACTOME:R-HSA-182971, REACTOME:R-HSA-186797, REACTOME:R-HSA-446652, REACTOME:R-HSA-449147, REACTOME:R-HSA-5663202, REACTOME:R-HSA-8863795, REACTOME:R-HSA-9006934, REACTOME:R-HSA-9008059, REACTOME:R-HSA-9634285", "Reactome": "Oncogenic_GrowthFactor_Signaling, Other_Mixed_or_Generic, Cytokine_JAK_STAT_Signaling", "Pathways": "Signaling by ERBB2, Signaling by ERBB2 in Cancer, SHC1 events in ERBB2 signaling" }, { "Gene": "CTSS", "Manual": "Antigen Presentation", "IDs": "REACTOME:R-HSA-1236975, REACTOME:R-HSA-1236977, REACTOME:R-HSA-1280218, REACTOME:R-HSA-1474228, REACTOME:R-HSA-1474244, REACTOME:R-HSA-1474290, REACTOME:R-HSA-1500931, REACTOME:R-HSA-1679131, REACTOME:R-HSA-168249, REACTOME:R-HSA-168256, REACTOME:R-HSA-168898, REACTOME:R-HSA-2022090, REACTOME:R-HSA-2132295, REACTOME:R-HSA-418990, REACTOME:R-HSA-421270, REACTOME:R-HSA-446728, REACTOME:R-HSA-6798695, REACTOME:R-HSA-9759476, REACTOME:R-HSA-9764265, REACTOME:R-HSA-9764274, REACTOME:R-HSA-9764561, REACTOME:R-HSA-9766229, REACTOME:R-HSA-983169", "Reactome": "Innate_Immunity_Myeloid_Phagocyte, Other_Mixed_or_Generic, ECM_Remodeling_Adhesion", "Pathways": "Antigen processing-Cross presentation, Endosomal/Vacuolar pathway, Adaptive Immune System" }, { "Gene": "CTSD", "Manual": "Antigen Presentation", "IDs": "REACTOME:R-HSA-1280218, REACTOME:R-HSA-1442490, REACTOME:R-HSA-1474228, REACTOME:R-HSA-1474244, REACTOME:R-HSA-162582, REACTOME:R-HSA-168249, REACTOME:R-HSA-168256, REACTOME:R-HSA-2022377, REACTOME:R-HSA-2132295, REACTOME:R-HSA-2980736, REACTOME:R-HSA-392499, REACTOME:R-HSA-6798695, REACTOME:R-HSA-74752, REACTOME:R-HSA-77387, REACTOME:R-HSA-8939211, REACTOME:R-HSA-9006931, REACTOME:R-HSA-9006934, REACTOME:R-HSA-9018519", "Reactome": "Other_Mixed_or_Generic, ECM_Remodeling_Adhesion, Innate_Immunity_Myeloid_Phagocyte, Metabolism, Cell_Cycle_DNA_Replication", "Pathways": "Adaptive Immune System, Collagen degradation, Degradation of the extracellular matrix" }, { "Gene": "CISH", "Manual": "Interferon Response", "IDs": "REACTOME:R-HSA-1266695, REACTOME:R-HSA-1280215, REACTOME:R-HSA-168256, REACTOME:R-HSA-392499, REACTOME:R-HSA-449147, REACTOME:R-HSA-597592, REACTOME:R-HSA-8951664, REACTOME:R-HSA-982772", "Reactome": "Cytokine_JAK_STAT_Signaling, Other_Mixed_or_Generic, Metabolism", "Pathways": "Interleukin-7 signaling, Cytokine Signaling in Immune system, Immune System" }, { "Gene": "IFITM2", "Manual": "Interferon Response", "IDs": "REACTOME:R-HSA-1280215, REACTOME:R-HSA-168256, REACTOME:R-HSA-909733, REACTOME:R-HSA-913531", "Reactome": "Cytokine_JAK_STAT_Signaling, Other_Mixed_or_Generic", "Pathways": "Cytokine Signaling in Immune system, Immune System, Interferon alpha/beta signaling" }, { "Gene": "MITF", "Manual": "Differentiation Control", "IDs": "REACTOME:R-HSA-1266738, REACTOME:R-HSA-2990846, REACTOME:R-HSA-3108232, REACTOME:R-HSA-3232118, REACTOME:R-HSA-392499, REACTOME:R-HSA-597592, REACTOME:R-HSA-9730414, REACTOME:R-HSA-9824585, REACTOME:R-HSA-9824594, REACTOME:R-HSA-9825892, REACTOME:R-HSA-9825895, REACTOME:R-HSA-9854907, REACTOME:R-HSA-9854909, REACTOME:R-HSA-9856649, REACTOME:R-HSA-9856651, REACTOME:R-HSA-9857377, REACTOME:R-HSA-9926550", "Reactome": "Other_Mixed_or_Generic, Metabolism, Apoptosis_Survival, Cell_Cycle_DNA_Replication, Stress_Response_DNA_Damage_Autophagy, ECM_Remodeling_Adhesion", "Pathways": "Developmental Biology, SUMOylation, SUMO E3 ligases SUMOylate target proteins" }, { "Gene": "TFEC", "Manual": "Differentiation Control", "IDs": "REACTOME:R-HSA-1266738, REACTOME:R-HSA-9730414, REACTOME:R-HSA-9856649", "Reactome": "Other_Mixed_or_Generic", "Pathways": "Developmental Biology, MITF-M-regulated melanocyte development, Transcriptional and post-translational regulation of MITF-M expression and activity" }, { "Gene": "SLC2A1", "Manual": "Glycolytic Shift (Warburg)", "IDs": "REACTOME:R-HSA-1430728, REACTOME:R-HSA-163685, REACTOME:R-HSA-1643685, REACTOME:R-HSA-189200, REACTOME:R-HSA-196836, REACTOME:R-HSA-196849, REACTOME:R-HSA-196854, REACTOME:R-HSA-382551, REACTOME:R-HSA-422356, REACTOME:R-HSA-425407, REACTOME:R-HSA-5619043, REACTOME:R-HSA-5619102, REACTOME:R-HSA-5619115, REACTOME:R-HSA-5653890, REACTOME:R-HSA-71387", "Reactome": "Metabolism, Other_Mixed_or_Generic", "Pathways": "Metabolism, Integration of energy metabolism, Disease" }, { "Gene": "HK2", "Manual": "Glycolytic Shift (Warburg)", "IDs": "REACTOME:R-HSA-1430728, REACTOME:R-HSA-70171, REACTOME:R-HSA-70326, REACTOME:R-HSA-71387", "Reactome": "Metabolism", "Pathways": "Metabolism, Glycolysis, Glucose metabolism" }, { "Gene": "PFKP", "Manual": "Glycolytic Shift (Warburg)", "IDs": "REACTOME:R-HSA-1430728, REACTOME:R-HSA-70171, REACTOME:R-HSA-70326, REACTOME:R-HSA-71387", "Reactome": "Metabolism", "Pathways": "Metabolism, Glycolysis, Glucose metabolism" }, { "Gene": "PKM", "Manual": "Glycolytic Shift (Warburg)", "IDs": "REACTOME:R-HSA-1428517, REACTOME:R-HSA-1430728, REACTOME:R-HSA-1500931, REACTOME:R-HSA-168249, REACTOME:R-HSA-168256, REACTOME:R-HSA-418990, REACTOME:R-HSA-421270, REACTOME:R-HSA-446728, REACTOME:R-HSA-6798695, REACTOME:R-HSA-70171, REACTOME:R-HSA-70268, REACTOME:R-HSA-70326, REACTOME:R-HSA-71387, REACTOME:R-HSA-9759476, REACTOME:R-HSA-9764265, REACTOME:R-HSA-9764274, REACTOME:R-HSA-9764560, REACTOME:R-HSA-9764725, REACTOME:R-HSA-9861718", "Reactome": "Metabolism, Other_Mixed_or_Generic, Innate_Immunity_Myeloid_Phagocyte, ECM_Remodeling_Adhesion", "Pathways": "Aerobic respiration and respiratory electron transport, Metabolism, Cell-Cell communication" }, { "Gene": "FABP5", "Manual": "Lipid Metabolism (Foamy TAMs)", "IDs": "REACTOME:R-HSA-1430728, REACTOME:R-HSA-162582, REACTOME:R-HSA-163560, REACTOME:R-HSA-168249, REACTOME:R-HSA-168256, REACTOME:R-HSA-5362517, REACTOME:R-HSA-556833, REACTOME:R-HSA-6798695, REACTOME:R-HSA-8979227, REACTOME:R-HSA-9006931", "Reactome": "Metabolism, Other_Mixed_or_Generic, Innate_Immunity_Myeloid_Phagocyte", "Pathways": "Metabolism, Signal Transduction, Triglyceride catabolism" }, { "Gene": "PLIN2", "Manual": "Lipid Metabolism (Foamy TAMs)", "IDs": "REACTOME:R-HSA-1430728, REACTOME:R-HSA-1632852, REACTOME:R-HSA-1989781, REACTOME:R-HSA-212165, REACTOME:R-HSA-400206, REACTOME:R-HSA-556833, REACTOME:R-HSA-74160, REACTOME:R-HSA-9612973, REACTOME:R-HSA-9613354, REACTOME:R-HSA-9613829, REACTOME:R-HSA-9615710, REACTOME:R-HSA-9663891, REACTOME:R-HSA-9818564, REACTOME:R-HSA-9841922, REACTOME:R-HSA-9851695, REACTOME:R-HSA-9917777", "Reactome": "Metabolism, Stress_Response_DNA_Damage_Autophagy, Other_Mixed_or_Generic", "Pathways": "Metabolism, Macroautophagy, PPARA activates gene expression" }, { "Gene": "ABHD5", "Manual": "Lipid Metabolism (Foamy TAMs)", "IDs": "REACTOME:R-HSA-1430728, REACTOME:R-HSA-163560, REACTOME:R-HSA-556833, REACTOME:R-HSA-8979227", "Reactome": "Metabolism, Other_Mixed_or_Generic", "Pathways": "Metabolism, Triglyceride catabolism, Metabolism of lipids" }, { "Gene": "VEGFA", "Manual": "Angiogenesis Support", "IDs": "REACTOME:R-HSA-109582, REACTOME:R-HSA-114608, REACTOME:R-HSA-1234158, REACTOME:R-HSA-1234174, REACTOME:R-HSA-1280215, REACTOME:R-HSA-162582, REACTOME:R-HSA-1643685, REACTOME:R-HSA-168256, REACTOME:R-HSA-194138, REACTOME:R-HSA-194313, REACTOME:R-HSA-195399, REACTOME:R-HSA-212436, REACTOME:R-HSA-2262752, REACTOME:R-HSA-4420097, REACTOME:R-HSA-449147, REACTOME:R-HSA-5218921, REACTOME:R-HSA-5663205, REACTOME:R-HSA-6785807, REACTOME:R-HSA-73857, REACTOME:R-HSA-74160, REACTOME:R-HSA-76002, REACTOME:R-HSA-76005, REACTOME:R-HSA-8864260, REACTOME:R-HSA-8866910, REACTOME:R-HSA-8953897, REACTOME:R-HSA-9006934, REACTOME:R-HSA-9679191, REACTOME:R-HSA-9679506, REACTOME:R-HSA-9824446", "Reactome": "Angiogenesis_Vascular_Hemostasis, Stress_Response_DNA_Damage_Autophagy, Cytokine_JAK_STAT_Signaling, Other_Mixed_or_Generic", "Pathways": "Hemostasis, Platelet degranulation, Regulation of gene expression by Hypoxia-inducible Factor" }];

        function toggleTable() {
            const overlay = document.getElementById("tableOverlay");
            const isVisible = overlay.style.display === "flex";
            overlay.style.display = isVisible ? "none" : "flex";

            const tbody = document.getElementById("tableBody");
            if (!isVisible && (tbody.children.length === 0 || tbody.innerHTML.trim().length < 50)) {
                populateTable();
            }
        }

        function toggleExpand(cell) {
            cell.classList.toggle('expanded');
        }

        function populateTable() {
            const tbody = document.getElementById("tableBody");

            tbody.innerHTML = MAPPING_DATA.map(d => {
                // Helper to format expandable cell
                const formatExpandable = (dataString) => {
                    const items = dataString.split(',').map(s => s.trim());
                    if (items.length <= 1) return dataString;

                    return `
                        <div class="expandable-cell" onclick="toggleExpand(this)">
                            <span class="summary-text">${items[0]} <span style="color:var(--text-secondary); font-size: 0.7rem;">(+${items.length - 1} more)</span></span>
                            <span class="expand-toggle">▼</span>
                            <div class="full-content">
                                ${items.join(', ')}
                            </div>
                        </div>
                    `;
                };

                return `
                    <tr>
                        <td style="font-weight:bold; color:var(--accent-color)">${d.Gene}</td>
                        <td>${d.Manual}</td>
                        <td style="font-size: 0.7rem; color: var(--text-secondary); max-width: 200px; overflow-wrap: break-word;">
                            ${formatExpandable(d.IDs)}
                        </td>
                        <td style="font-size: 0.75rem">
                            ${formatExpandable(d.Reactome)}
                        </td>
                        <td>${d.Pathways}</td>
                    </tr>
                `;
            }).join("");
        }

        loadData();

    </script>
</body>

</html>